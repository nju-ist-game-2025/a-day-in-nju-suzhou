# Boss房间对话系统使用说明

## 概述
当玩家首次进入boss房间时，会触发一个类似关卡开头的对话框系统，用于展示boss的背景故事或战前对话。

## 配置方法

### 1. 在JSON配置文件中添加 `bossDialog` 字段

在任何 `hasBoss: true` 的房间配置中，添加 `bossDialog` 数组字段：

```json
{
  "id": 8,
  "name": "Boss Room",
  "background": "map1",
  "hasBoss": true,
  "bossDialog": [
    "（智科er推开最后一扇门）",
    "**智科er** \n（看着眼前的Boss）",
    "【Boss】\n『欢迎来到最终考验！』",
    "**智科er** \n 我准备好了！",
    "（Boss战开始！）"
  ],
  "hasChest": true,
  "doors": {
    "up": -1,
    "down": -1,
    "left": -1,
    "right": 6
  }
}
```

### 2. 对话格式说明

- **数组元素**：每个字符串代表一段对话
- **换行**：使用 `\n` 表示换行
- **角色名**：使用 `**角色名**` 表示说话者（粗体显示）
- **旁白**：使用 `（）` 或 `【】` 表示旁白或场景描述
- **Boss台词**：使用 `【Boss名】\n『台词』` 格式

### 3. 示例对话结构

```json
"bossDialog": [
  "（场景描述：环境氛围）",
  "**主角名** \n（角色动作或心理描写）",
  "**主角名** \n 对话内容",
  "【Boss名】\n『Boss的台词』",
  "【Boss名】\n『Boss的威胁或挑战』",
  "**主角名** \n（主角反应）",
  "**主角名** \n 主角回应",
  "（战斗即将开始的氛围描写）"
]
```

## 技术实现

### 触发时机
- 玩家**首次进入**标记为 `hasBoss: true` 的房间时
- 只在首次进入时触发，重复进入不会再显示

### 显示方式
- 使用与关卡开头相同的对话框系统
- 背景图片根据关卡号自动选择（l1.png, l2.png, l3.png）
- 点击屏幕或按空格键继续下一段对话
- 对话结束后自动初始化boss房间（生成敌人、boss等）

### 代码接口

**LevelConfig.h**：
```cpp
struct RoomConfig {
    // ... 其他字段
    bool hasBoss;              // 是否有Boss
    QStringList bossDialog;    // Boss房间的对话文案
    // ...
};
```

**使用示例**：
```cpp
// 在level.cpp的enterNextRoom()中自动处理
if (isFirstEnterBossRoom && !newRoomCfg.bossDialog.isEmpty()) {
    showStoryDialog(newRoomCfg.bossDialog, true);
}
```

## 已配置的关卡

### 第一关 - 起床战争
- Boss：巨型闹钟
- 主题：征服早起困难
- 对话风格：轻松幽默

### 第二关 - 洗衣房
- Boss：脏袜子Boss
- 主题：对抗拖延症
- 对话风格：自嘲讽刺

### 第三关 - 教室
- Boss：教室Boss（期末考试）
- 主题：最终考验
- 对话风格：紧张激励

## 注意事项

1. **可选配置**：`bossDialog` 字段是可选的，如果不配置，进入boss房间时不会显示对话
2. **数组不能为空**：如果添加了 `bossDialog` 字段，请确保至少有一段对话
3. **字符转义**：JSON中的特殊字符需要转义，如 `\n` 表示换行
4. **编码格式**：确保JSON文件使用UTF-8编码，以正确显示中文字符

## 扩展建议

1. **个性化对话**：为不同关卡的boss设计独特的对话风格
2. **剧情连贯性**：可以在boss对话中呼应关卡开头的剧情
3. **情绪渲染**：使用场景描写和角色心理活动增强代入感
4. **长度控制**：建议每个boss对话5-10段，避免过长导致玩家失去耐心

## 测试建议

1. 进入游戏，通关所有普通房间
2. 当boss门开启时，进入boss房间
3. 验证boss对话是否正常显示
4. 点击或按空格键测试对话切换
5. 对话结束后验证boss战是否正常开始
